# https://gist.github.com/MightyPork/6da26e382a7ad91b5496ee55fdc73db2
keymap = {
  0x04: "a",  # Keyboard a and A
  0x05: "b",  # Keyboard b and B
  0x06: "c",  # Keyboard c and C
  0x07: "d",  # Keyboard d and D
  0x08: "e",  # Keyboard e and E
  0x09: "f",  # Keyboard f and F
  0x0a: "g",  # Keyboard g and G
  0x0b: "h",  # Keyboard h and H
  0x0c: "i",  # Keyboard i and I
  0x0d: "j",  # Keyboard j and J
  0x0e: "k",  # Keyboard k and K
  0x0f: "l",  # Keyboard l and L
  0x10: "m",  # Keyboard m and M
  0x11: "n",  # Keyboard n and N
  0x12: "o",  # Keyboard o and O
  0x13: "p",  # Keyboard p and P
  0x14: "q",  # Keyboard q and Q
  0x15: "r",  # Keyboard r and R
  0x16: "s",  # Keyboard s and S
  0x17: "t",  # Keyboard t and T
  0x18: "u",  # Keyboard u and U
  0x19: "v",  # Keyboard v and V
  0x1a: "w",  # Keyboard w and W
  0x1b: "x",  # Keyboard x and X
  0x1c: "y",  # Keyboard y and Y
  0x1d: "z",  # Keyboard z and Z

  0x1e: "1",  # Keyboard 1 and !
  0x1f: "2",  # Keyboard 2 and @
  0x20: "3",  # Keyboard 3 and #
  0x21: "4",  # Keyboard 4 and $
  0x22: "5",  # Keyboard 5 and %
  0x23: "6",  # Keyboard 6 and ^
  0x24: "7",  # Keyboard 7 and &
  0x25: "8",  # Keyboard 8 and *
  0x26: "9",  # Keyboard 9 and (
  0x27: "0",  # Keyboard 0 and )

  0x28: "[ENTER]",  # Keyboard Return (ENTER)
  0x29: "[ESC]",  # Keyboard ESCAPE
  0x2a: "[BACKSPACE]",  # Keyboard DELETE (Backspace)
  0x2b: "[TAB]",  # Keyboard Tab
  0x2c: "[SPACE]",  # Keyboard Spacebar
  0x2d: "-",  # Keyboard - and _
  0x2e: "[EQUAL]",  # Keyboard = and +
  0x2f: "[",  # Keyboard [ and {
  0x30: "]",  # Keyboard ] and }
  0x31: "[BACKSLASH]",  # Keyboard \ and |
  0x32: "[HASHTILDE]",  # Keyboard Non-US # and ~
  0x33: ";",  # Keyboard ; and :
  0x34: "[APOSTROPHE]",  # Keyboard ' and "
  0x35: "[GRAVE]",  # Keyboard ` and ~
  0x36: "[COMMA]",  # Keyboard , and <
  0x37: "[DOT]",  # Keyboard . and >
  0x38: "[SLASH]",  # Keyboard / and ?
  0x39: "[CAPSLOCK]",  # Keyboard Caps Lock

  0x3a: "[F1]",  # Keyboard F1
  0x3b: "[F2]",  # Keyboard F2
  0x3c: "[F3]",  # Keyboard F3
  0x3d: "[F4]",  # Keyboard F4
  0x3e: "[F5]",  # Keyboard F5
  0x3f: "[F6]",  # Keyboard F6
  0x40: "[F7]",  # Keyboard F7
  0x41: "[F8]",  # Keyboard F8
  0x42: "[F9]",  # Keyboard F9
  0x43: "[F10]",  # Keyboard F10
  0x44: "[F11]",  # Keyboard F11
  0x45: "[F12]",  # Keyboard F12

  0x46: "[SYSRQ]",  # Keyboard Print Screen
  0x47: "[SCROLLLOCK]",  # Keyboard Scroll Lock
  0x48: "[PAUSE]",  # Keyboard Pause
  0x49: "[INSERT]",  # Keyboard Insert
  0x4a: "[HOME]",  # Keyboard Home
  0x4b: "[PAGEUP]",  # Keyboard Page Up
  0x4c: "[DELETE]",  # Keyboard Delete Forward
  0x4d: "[END]",  # Keyboard End
  0x4e: "[PAGEDOWN]",  # Keyboard Page Down
  0x4f: "[RIGHT]",  # Keyboard Right Arrow
  0x50: "[LEFT]",  # Keyboard Left Arrow
  0x51: "[DOWN]",  # Keyboard Down Arrow
  0x52: "[UP]",  # Keyboard Up Arrow

  0x53: "[NUMLOCK]",  # Keyboard Num Lock and Clear
  0x54: "[KPSLASH]",  # Keypad /
  0x55: "[KPASTERISK]",  # Keypad *
  0x56: "[KPMINUS]",  # Keypad -
  0x57: "[KPPLUS]",  # Keypad +
  0x58: "[KPENTER]",  # Keypad ENTER
  0x59: "[KP1]",  # Keypad 1 and End
  0x5a: "[KP2]",  # Keypad 2 and Down Arrow
  0x5b: "[KP3]",  # Keypad 3 and PageDn
  0x5c: "[KP4]",  # Keypad 4 and Left Arrow
  0x5d: "[KP5]",  # Keypad 5
  0x5e: "[KP6]",  # Keypad 6 and Right Arrow
  0x5f: "[KP7]",  # Keypad 7 and Home
  0x60: "[KP8]",  # Keypad 8 and Up Arrow
  0x61: "[KP9]",  # Keypad 9 and Page Up
  0x62: "[KP0]",  # Keypad 0 and Insert
  0x63: "[KPDOT]",  # Keypad . and Delete

  0x64: "[102ND]",  # Keyboard Non-US \ and |
  0x65: "[COMPOSE]",  # Keyboard Application
  0x66: "[POWER]",  # Keyboard Power
  0x67: "[KPEQUAL]",  # Keypad =

  0x68: "[F13]",  # Keyboard F13
  0x69: "[F14]",  # Keyboard F14
  0x6a: "[F15]",  # Keyboard F15
  0x6b: "[F16]",  # Keyboard F16
  0x6c: "[F17]",  # Keyboard F17
  0x6d: "[F18]",  # Keyboard F18
  0x6e: "[F19]",  # Keyboard F19
  0x6f: "[F20]",  # Keyboard F20
  0x70: "[F21]",  # Keyboard F21
  0x71: "[F22]",  # Keyboard F22
  0x72: "[F23]",  # Keyboard F23
  0x73: "[F24]",  # Keyboard F24

  0x74: "[OPEN]",  # Keyboard Execute
  0x75: "[HELP]",  # Keyboard Help
  0x76: "[PROPS]",  # Keyboard Menu
  0x77: "[FRONT]",  # Keyboard Select
  0x78: "[STOP]",  # Keyboard Stop
  0x79: "[AGAIN]",  # Keyboard Again
  0x7a: "[UNDO]",  # Keyboard Undo
  0x7b: "[CUT]",  # Keyboard Cut
  0x7c: "[COPY]",  # Keyboard Copy
  0x7d: "[PASTE]",  # Keyboard Paste
  0x7e: "[FIND]",  # Keyboard Find
  0x7f: "[MUTE]",  # Keyboard Mute
  0x80: "[VOLUMEUP]",  # Keyboard Volume Up
  0x81: "[VOLUMEDOWN]",  # Keyboard Volume Down
}


with open('leftoverdata.txt') as f:
    for line in f.readlines():
        bytesArray = bytearray.fromhex(line.strip().replace(':', ''))
        KEY_MOD_RSHIFT = bytesArray[0] == 0x20
        KEY_MOD_LALT = bytesArray[0] == 0x4
        assert bytesArray[0] == 0x0 or (KEY_MOD_RSHIFT or KEY_MOD_LALT)
        assert bytesArray[1] == 0x0
        for byte in bytesArray[2:]:
            #byte = bytesArray[3]
            wat = sum([1 if c != 0 else 0 for c in bytesArray[2:]])
            #if wat > 1:
            #    print('')
            #    print(bytesArray)
            if byte != 0 and wat == 1:
                keyVal = int(byte)
                assert keyVal in keymap
                
                modifier = lambda x: x
                if KEY_MOD_RSHIFT:
                    modifier = lambda x: x.replace('-', '_').replace('[', '{').replace(']', '}').replace(';', ':').upper()
                elif KEY_MOD_LALT:
                    modifier = lambda x: '[?' + x + ']'
                
                print(modifier(keymap[keyVal]), end='')


print('')
